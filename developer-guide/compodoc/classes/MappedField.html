<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>@atlasmap/atlasmap-data-mapper documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">@atlasmap/atlasmap-data-mapper documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">











<ol class="breadcrumb">
  <li>Classes</li>
  <li>MappedField</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/lib/atlasmap-data-mapper/models/mapping.model.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#actions">actions</a>
                            </li>
                            <li>
                                <a href="#field">field</a>
                            </li>
                            <li>
                                <a href="#parsedData">parsedData</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#isPadField">isPadField</a>
                            </li>
                            <li>
                                <a href="#isSource">isSource</a>
                            </li>
                            <li>
                                <a href="#removeAction">removeAction</a>
                            </li>
                            <li>
                                    <span class="modifier">Static</span>
                                <a href="#sortMappedFieldsByPath">sortMappedFieldsByPath</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>


            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="actions"></a>
                        <span class="name">
                            <b>
                            actions</b>
                            <a href="#actions"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>FieldAction[]</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>[]</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="42" class="link-to-prism">src/app/lib/atlasmap-data-mapper/models/mapping.model.ts:42</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="field"></a>
                        <span class="name">
                            <b>
                            field</b>
                            <a href="#field"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../classes/Field.html" target="_self" >Field</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="41" class="link-to-prism">src/app/lib/atlasmap-data-mapper/models/mapping.model.ts:41</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="parsedData"></a>
                        <span class="name">
                            <b>
                            parsedData</b>
                            <a href="#parsedData"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../classes/MappedFieldParsingData.html" target="_self" >MappedFieldParsingData</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>new MappedFieldParsingData()</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="40" class="link-to-prism">src/app/lib/atlasmap-data-mapper/models/mapping.model.ts:40</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isPadField"></a>
                    <span class="name">
                        <b>
                            isPadField
                        </b>
                        <a href="#isPadField"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>isPadField()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="66"
                            class="link-to-prism">src/app/lib/atlasmap-data-mapper/models/mapping.model.ts:66</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isSource"></a>
                    <span class="name">
                        <b>
                            isSource
                        </b>
                        <a href="#isSource"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>isSource()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="70"
                            class="link-to-prism">src/app/lib/atlasmap-data-mapper/models/mapping.model.ts:70</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="removeAction"></a>
                    <span class="name">
                        <b>
                            removeAction
                        </b>
                        <a href="#removeAction"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>removeAction(action: <a href="../classes/FieldAction.html">FieldAction</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="74"
                            class="link-to-prism">src/app/lib/atlasmap-data-mapper/models/mapping.model.ts:74</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>action</td>
                                    <td>
                                                <code><a href="../classes/FieldAction.html" target="_self" >FieldAction</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sortMappedFieldsByPath"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Static</span>
                            sortMappedFieldsByPath
                        </b>
                        <a href="#sortMappedFieldsByPath"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>sortMappedFieldsByPath(mappedFields: MappedField[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="44"
                            class="link-to-prism">src/app/lib/atlasmap-data-mapper/models/mapping.model.ts:44</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>mappedFields</td>
                                    <td>
                                            <code>MappedField[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>MappedField[]</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>





    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { ConfigModel } from &#x27;../models/config.model&#x27;;
import { Field } from &#x27;./field.model&#x27;;
import { TransitionModel } from &#x27;./transition.model&#x27;;
import { ErrorInfo, ErrorLevel } from &#x27;../models/error.model&#x27;;

import { DataMapperUtil } from &#x27;../common/data-mapper-util&#x27;;
import { FieldAction } from &#x27;./field-action.model&#x27;;
import { PaddingField } from &#x27;./document-definition.model&#x27;;

export class MappedFieldParsingData {
  parsedName: string &#x3D; null;
  parsedPath: string &#x3D; null;
  parsedValue: string &#x3D; null;
  parsedDocID: string &#x3D; null;
  parsedDocURI: string &#x3D; null;
  parsedIndex: string &#x3D; null;
  fieldIsProperty &#x3D; false;
  fieldIsConstant &#x3D; false;
  parsedValueType: string &#x3D; null;
  parsedActions: FieldAction[] &#x3D; [];
  userCreated &#x3D; false;
}

export class MappedField {
  parsedData: MappedFieldParsingData &#x3D; new MappedFieldParsingData();
  field: Field;
  actions: FieldAction[] &#x3D; [];

  static sortMappedFieldsByPath(mappedFields: MappedField[]): MappedField[] {
    if (mappedFields &#x3D;&#x3D; null || mappedFields.length &#x3D;&#x3D;&#x3D; 0) {
      return [];
    }
    const fieldsByPath: { [key: string]: MappedField; } &#x3D; {};
    const fieldPaths: string[] &#x3D; [];
    for (const mappedField of mappedFields) {
      if (mappedField &#x3D;&#x3D; null || mappedField.field &#x3D;&#x3D; null) {
        continue;
      }
      const path: string &#x3D; mappedField.field.path;
      fieldsByPath[path] &#x3D; mappedField;
      fieldPaths.push(path);
    }
    fieldPaths.sort();
    const result: MappedField[] &#x3D; [];
    for (const name of fieldPaths) {
      result.push(fieldsByPath[name]);
    }
    return result;
  }

  isPadField(): boolean {
    return this.field instanceof PaddingField;
  }

  isSource(): boolean {
    return this.field.isSource();
  }

  removeAction(action: FieldAction): void {
    DataMapperUtil.removeItemFromArray(action, this.actions);
  }

}

export class MappingModel {
  cfg: ConfigModel;
  uuid: string;

  sourceFields: MappedField[] &#x3D; [];
  targetFields: MappedField[] &#x3D; [];
  transition: TransitionModel &#x3D; new TransitionModel();

  validationErrors: ErrorInfo[] &#x3D; []; // must be immutable
  previewErrors: ErrorInfo[] &#x3D; []; // must be immutable

  constructor() {
    this.uuid &#x3D; &#x27;mapping.&#x27; + Math.floor((Math.random() * 1000000) + 1).toString();
    this.cfg &#x3D; ConfigModel.getConfig();
    Object.freeze(this.validationErrors);
  }

  addValidationError(message: string) {
    const e &#x3D; new ErrorInfo(message, ErrorLevel.VALIDATION_ERROR);
    this.validationErrors &#x3D; [...this.validationErrors, e];
    Object.freeze(this.validationErrors);
  }

  clearValidationErrors(): void {
    this.validationErrors &#x3D; [];
    Object.freeze(this.validationErrors);
  }

  getValidationErrors(): ErrorInfo[] {
    return this.validationErrors.filter(e &#x3D;&gt; e.level &gt;&#x3D; ErrorLevel.ERROR);
  }

  getValidationWarnings(): ErrorInfo[] {
    return this.validationErrors.filter(e &#x3D;&gt; e.level &#x3D;&#x3D;&#x3D; ErrorLevel.WARN);
  }

  removeValidationError(identifier: string) {
    this.validationErrors &#x3D; this.validationErrors.filter(e &#x3D;&gt; e.identifier !&#x3D;&#x3D; identifier);
    Object.freeze(this.validationErrors);
  }

  clearPreviewErrors(): void {
    this.previewErrors &#x3D; [];
    Object.freeze(this.previewErrors);
  }

  getPreviewErrors(): ErrorInfo[] {
    return this.previewErrors.filter(e &#x3D;&gt; e.level &gt;&#x3D; ErrorLevel.ERROR);
  }

  getPreviewWarnings(): ErrorInfo[] {
    return this.previewErrors.filter(e &#x3D;&gt; e.level &#x3D;&#x3D;&#x3D; ErrorLevel.WARN);
  }

  removePreviewError(identifier: string) {
    this.previewErrors &#x3D; this.previewErrors.filter(e &#x3D;&gt; e.identifier !&#x3D;&#x3D; identifier);
    Object.freeze(this.previewErrors);
  }

  getFirstCollectionField(isSource: boolean): Field {
    for (const f of isSource ? this.sourceFields : this.targetFields) {
      if (f.field.isInCollection()) {
        return f.field;
      }
    }
    return null;
  }

  isLookupMode(): boolean {
    for (const f of this.sourceFields.concat(this.targetFields)) {
      if (f.field.enumeration) {
        return true;
      }
    }
    return false;
  }

  /**
   * Add the specified field to this field mapping.
   *
   * @param field - field to add to the mapping
   * @param first - if true add the field to the beginning of the array, last otherwise.
   */
  addField(field: Field, first: boolean): MappedField {
    const mappedField: MappedField &#x3D; new MappedField();
    mappedField.field &#x3D; field;
    if (first) {
      this.getMappedFields(field.isSource()).unshift(mappedField);
    } else {
      this.getMappedFields(field.isSource()).push(mappedField);
    }
    return mappedField;
  }

  /**
   * Remove the specified field from this field mapping.
   *
   * @param field
   */
  removeField(field: Field) {
    const mappedFields &#x3D; this.getMappedFields(field.isSource());
    DataMapperUtil.removeItemFromArray(mappedFields.find(mf &#x3D;&gt; mf.field &#x3D;&#x3D;&#x3D; field), mappedFields);
  }

  /**
   * Return the number of user-defined (non-padding) fields in this mapping.
   *
   * @param field
   */
  getUserFieldCount(field: Field): number {
    const mappedFields &#x3D; this.getMappedFields(field.isSource());
    let userFieldCount &#x3D; 0;

    for (const mappedField of mappedFields) {
      if (!mappedField.isPadField()) {
        userFieldCount++;
      }
    }
    return userFieldCount;
  }

  hasMappedField(isSource: boolean) {
    return isSource ? this.sourceFields.length &gt; 0 : this.targetFields.length &gt; 0;
  }

  isEmpty() {
    return this.sourceFields.length &#x3D;&#x3D;&#x3D; 0 &amp;&amp; this.targetFields.length &#x3D;&#x3D;&#x3D; 0;
  }

  isFullyMapped(): boolean {
    return this.sourceFields.length &gt; 0 &amp;&amp; this.targetFields.length &gt; 0;
  }

  addMappedField(mappedField: MappedField, isSource: boolean): void {
    this.getMappedFields(isSource).push(mappedField);
  }

  removeMappedField(mappedField: MappedField): void {
    DataMapperUtil.removeItemFromArray(mappedField, this.getMappedFields(mappedField.field.isSource()));
  }

  getMappedFieldForField(field: Field): MappedField {
    for (const mappedField of this.getMappedFields(field.isSource())) {
      if (mappedField.field &#x3D;&#x3D;&#x3D; field) {
        return mappedField;
      }
    }
    return null;
  }

  getMappedFieldForIndex(index: string, isSource: boolean): MappedField {
    if (!index) {
      return null;
    }
    const mappedFields &#x3D; this.getMappedFields(isSource);
    if (+index - 1 &gt; mappedFields.length - 1) {
      return null;
    }
    return mappedFields[+index - 1];
  }

  getIndexForMappedField(mappedField: MappedField): number {
    if (!mappedField || !mappedField.field) {
      return null;
    }
    return this.getMappedFields(mappedField.field.isSource()).indexOf(mappedField) + 1;
  }

  /**
   * Return an array of user mapped fields for the specified panel in this field pair instance.  No
   * data-mapper generated padding fields will be included.
   *
   * @param isSource - true source panel, false target panel
   */
  getUserMappedFields(isSource: boolean): MappedField[] {
    const workingFields &#x3D; isSource ? this.sourceFields : this.targetFields;
    const resultFields: MappedField[] &#x3D; [new MappedField()];

    for (const mappedField of workingFields) {
      if (!mappedField.isPadField()) {
        resultFields.push(mappedField);
      }
    }
    resultFields.shift();
    return resultFields;
  }

  getMappedFields(isSource: boolean): MappedField[] {
    return isSource ? this.sourceFields : this.targetFields;
  }

  getLastMappedField(isSource: boolean): MappedField {
    const fields: MappedField[] &#x3D; this.getMappedFields(isSource);
    if ((fields !&#x3D; null) &amp;&amp; (fields.length &gt; 0)) {
      return fields[fields.length - 1];
    }
    return null;
  }

  getFields(isSource: boolean): Field[] {
    const fields: Field[] &#x3D; [];
    for (const mappedField of this.getMappedFields(isSource)) {
      if (mappedField.field !&#x3D; null) {
        fields.push(mappedField.field);
      }
    }
    return fields;
  }

  getFieldNames(isSource: boolean): string[] {
    const fields: Field[] &#x3D; this.getFields(isSource);
    Field.alphabetizeFields(fields);
    const names: string[] &#x3D; [];
    for (const field of fields) {
      names.push(field.name);
    }
    return names;
  }

  getFieldPaths(isSource: boolean): string[] {
    const fields: Field[] &#x3D; this.getFields(isSource);
    Field.alphabetizeFields(fields);
    const paths: string[] &#x3D; [];
    for (const field of fields) {
      paths.push(field.path);
    }
    return paths;
  }

  hasFieldActions(): boolean {
    for (const mappedField of this.getAllMappedFields()) {
      if (mappedField.actions.length &gt; 0) {
        return true;
      }
    }
    return false;
  }

  getAllFields(): Field[] {
    return this.getFields(true).concat(this.getFields(false));
  }

  getAllMappedFields(): MappedField[] {
    return this.getMappedFields(true).concat(this.getMappedFields(false));
  }

  isFieldMapped(field: Field): boolean {
    return this.getMappedFieldForField(field) !&#x3D; null;
  }

  hasTransformation(): boolean {
    const mappedFields: MappedField[] &#x3D; this.getAllMappedFields();
    for (const mappedField of mappedFields) {
      if (mappedField.actions.length &gt; 0) {
        return true;
      }
    }
    return false;
  }

  /**
   * Walk all target field mappings and return one of corresponding source field name
   * if the specified field is already the target of a previous mapping, null otherwise.
   *
   * @param field
   */
  public getMappedTarget(field: Field): string {
    const mappings: MappingModel[] &#x3D; this.cfg.mappings.mappings;

    if (field.isSource()) {
      return null;
    }
    for (const m of mappings) {
      if (m.targetFields.length &#x3D;&#x3D;&#x3D; 0) {
        continue;
      }

      for (const mappedOutputField of m.targetFields) {
        if (mappedOutputField.field.docDef &#x3D;&#x3D;&#x3D; field.docDef
          &amp;&amp; mappedOutputField.field.path &#x3D;&#x3D;&#x3D; field.path) {
          if (m.isFieldMapped(field)) {
            return m.sourceFields[0].field.name;
          }
        }
      }
    }
  }

}
</code></pre>
    </div>
</div>



                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'MappedField.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
